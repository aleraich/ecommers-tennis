<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>RAHEL - Tienda Online</title>
    <link rel="stylesheet" href="styles.css" />
</head>
<body>
    <header>
        <div class="top-bar">
            <div class="left">
                <h1 class="brand-name">RAHEL</h1>
                <input type="search" id="searchInput" placeholder="Buscar productos..." />
            </div>
            <div class="right">
                <span class="auth-link" id="btnLogin">Entrar</span>
                <span class="auth-link" id="btnRegister">Registrarse</span>
            </div>
        </div>

        <nav class="main-nav">
            <ul>
                <li><a href="#">inicio</a></li>
                <li><a href="#">Marcas</a></li>
                <li><a href="#">Nuevo</a></li>
                <li><a href="#">Hombres</a></li>
                <li><a href="#">Mujeres</a></li>
                <li><a href="#">Niños</a></li>
                <li><a href="#">Calzados</a></li>
                <li><a href="#">Ropa</a></li>
                <li><a href="#">Accesorios</a></li>
                <li><a href="#">Más categorías</a></li>
                <li><a href="#">Ofertas</a></li>
                <li><a href="admin.html">Administrar</a></li>
            </ul>
        </nav>
    </header>

    <main class="container">
        <h2>Productos</h2>
        <div class="loading-message" id="loadingMessage">Cargando productos...</div>
        <div class="error-message" id="errorMessage" style="display:none;"></div>
        <div class="empty-message" id="emptyMessage" style="display:none;">No hay productos disponibles.</div>
        <div class="product-grid" id="productGrid"></div>
    </main>

    <!-- MODAL -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <span class="close" id="modalClose">&times;</span>

            <div id="loginForm" class="modal-form">
                <h2>Entrar</h2>
                <input type="email" id="loginEmail" placeholder="Correo electrónico" />
                <input type="password" id="loginPassword" placeholder="Contraseña" />
                <button id="loginSubmit">Ingresar</button>
            </div>

            <div id="registerForm" class="modal-form" style="display:none;">
                <h2>Registrarse</h2>
                <input type="text" id="registerName" placeholder="Nombre completo" />
                <input type="email" id="registerEmail" placeholder="Correo electrónico" />
                <input type="password" id="registerPassword" placeholder="Contraseña" />
                <button id="registerSubmit">Registrar</button>
            </div>
        </div>
    </div>

    <script>
        // Funciones para abrir y cerrar modal
        const modal = document.getElementById('modal');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');

        document.getElementById('btnLogin').addEventListener('click', () => {
            loginForm.style.display = 'block';
            registerForm.style.display = 'none';
            modal.style.display = 'block';
        });

        document.getElementById('btnRegister').addEventListener('click', () => {
            loginForm.style.display = 'none';
            registerForm.style.display = 'block';
            modal.style.display = 'block';
        });

        document.getElementById('modalClose').addEventListener('click', () => {
            modal.style.display = 'none';
        });

        window.addEventListener('click', (event) => {
            if(event.target === modal) {
                modal.style.display = 'none';
            }
        });

        // Cargar productos y buscar con el input
        async function loadProducts(query = '') {
            const loadingMessage = document.getElementById('loadingMessage');
            const errorMessage = document.getElementById('errorMessage');
            const emptyMessage = document.getElementById('emptyMessage');
            const productGrid = document.getElementById('productGrid');

            try {
                loadingMessage.style.display = 'block';
                errorMessage.style.display = 'none';
                emptyMessage.style.display = 'none';
                productGrid.innerHTML = '';

                // Cambiar URL si hay query para filtrar
                const url = query 
                    ? `http://localhost:3000/products?search=${encodeURIComponent(query)}` 
                    : 'http://localhost:3000/products';

                const response = await fetch(url, { method: 'GET' });
                if (!response.ok) throw new Error(`Error ${response.status}`);

                const products = await response.json();
                loadingMessage.style.display = 'none';

                if (!products || products.length === 0) {
                    emptyMessage.style.display = 'block';
                    return;
                }
                renderProducts(products);
            } catch (err) {
                loadingMessage.style.display = 'none';
                errorMessage.style.display = 'block';
                errorMessage.textContent = `Error al cargar productos: ${err.message}`;
            }
        }

        function renderProducts(products) {
            const productGrid = document.getElementById('productGrid');
            products.forEach(({ name, description, price, image_url }) => {
                const card = document.createElement('div');
                card.className = 'product-card';
                card.innerHTML = `
                    <img src="${image_url || 'https://via.placeholder.com/250'}" alt="${name}" />
                    <h3>${name}</h3>
                    <p>${description || ''}</p>
                    <p class="price">$${price}</p>
                `;
                productGrid.appendChild(card);
            });
        }

        // Evento buscar
        document.getElementById('searchInput').addEventListener('input', (e) => {
            const query = e.target.value.trim();
            loadProducts(query);
        });

        // Cargar productos al inicio
        document.addEventListener('DOMContentLoaded', () => {
            loadProducts();
        });
    </script>
</body>
</html>
